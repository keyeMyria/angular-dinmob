<div class="container">

  <div *ngIf="loading">
    <mat-spinner class="loading"></mat-spinner>
  </div>

  <div class="row">
    <div class="col-12">


      <div class="card my-2">
        <div>
          <mat-tab-group>
            <!-- Lote -->
            <mat-tab label="Lote">

              <div class="p15px">
                <div class="form-group row">
                  <label for="obra" class="col-form-label col-sm-3">Obra</label>
                  <div class="col-sm-9">
                    <input type="text" class="form-control" name="obra" [(ngModel)]="lote.lote.obra">
                  </div>
                </div>
                <div class="form-group row">
                  <label for="manzana" class="col-form-label col-sm-3">Manzana</label>
                  <div class="col-sm-9">
                    <input type="text" class="form-control" [(ngModel)]="lote.lote.manzana" name="manzana">
                  </div>
                </div>
                <div class="form-group row">
                  <label for="id_lote" class="col-form-label col-sm-3">Lote</label>
                  <div class="col-sm-9">
                    <input type="text" class="form-control" [(ngModel)]="lote.lote.id_lote" name="id_lote">
                  </div>
                </div>
                <div class="form-group row">
                  <label for="id_estado_venta" class="col-form-label col-sm-3">Estado Venta</label>
                  <div class="col-sm-9">
                    <input type="text" class="form-control" [(ngModel)]="lote.lote.id_estado_venta" name="id_estado_venta">
                  </div>
                </div>
                <div class="form-group row">
                  <label for="fecha_cambio_estado" class="col-form-label col-sm-3">Fecha Estado</label>
                  <div class="col-sm-9">
                    <input type="text" class="form-control" [(ngModel)]="lote.lote.fecha_cambio_estado" name="fecha_cambio_estado">
                  </div>
                </div>
                <div class="form-group row">
                  <label for="valor_base" class="col-form-label col-sm-3">Precio de Lista</label>
                  <div class="col-sm-9">
                    <input type="text" class="form-control" [(ngModel)]="lote.lote.valor_base" name="valor_base">
                  </div>
                </div>
                <div class="form-group row">
                  <label for="valor_ampliacion" class="col-form-label col-sm-3">Valor Ampliación</label>
                  <div class="col-sm-9">
                    <input type="text" class="form-control" [(ngModel)]="lote.lote.valor_ampliacion" name="valor_ampliacion">
                  </div>
                </div>
              </div>

              <div class="form-group">
                <div class="col-sm-9">
                  <button type="submit" class="btn btn-primary">Guardar Cambios</button>
                </div>
              </div>


            </mat-tab>
            <!-- Cliente -->
            <mat-tab label="Cliente">
              <div class="p15px">
                <div class="table-responsive">
                  <table class="table table-striped">
                    <thead>
                      <tr>
                        <th></th>
                        <th>Nombre</th>
                        <th>Activo</th>
                        <th>Fecha Activación</th>
                        <th>Fecha Cancelación</th>
                        <th></th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr *ngFor="let cliente of lote.clientes">
                        <td>
                          <mat-checkbox (change)="seleccionarCliente($event,cliente)"></mat-checkbox>
                        </td>
                        <td>
                          <span *ngIf="cliente.persona_moral === '0'">{{cliente.nombre_persona_fisica}}</span>
                          <span *ngIf="cliente.persona_moral === '1'">{{cliente.razon_social_persona_moral}}</span>
                        </td>
                        <td>{{cliente.activa}}</td>
                        <td>{{cliente.fecha_activo}}</td>
                        <td>{{cliente.fecha_cancelacion}}</td>
                        <td>
                          <button class="btn btn-outline-secondary btn-sm" (click)="gotoCliente(cliente)">
                            <i class="fa fa-pencil"></i>
                          </button>
                        </td>
                      </tr>

                    </tbody>

                  </table>
                </div>

              </div>


              <div class="table-responsive">
                <table class="table table-striped">
                  <thead>
                    <tr>
                      <th>Programación</th>
                      <th>Pago</th>
                      <th>Monto</th>
                      <th>Tipo</th>
                      <th>Forma</th>
                      <th>Nota</th>
                      <th>Validado</th>
                      <th>Comprobante</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let pago of cliente_selected.pagos">
                      <td>{{pago.fecha_programada}}</td>
                      <td>{{pago.fecha_pago}}</td>
                      <td>{{pago.monto|currency}}</td>
                      <td>{{pago.tipo_pago}}</td>
                      <td>{{pago.forma_pago}}</td>
                      <td>{{pago.nota}}</td>
                      <td>{{pago.validado}}</td>
                      <td>
                        <a class="btn btn-outline-secondary btn-sm" [href]="'/controlapi/public/comprobantes/'+pago.file_ficha_deposito">
                          <i class="fa fa-money"></i>
                        </a>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>

              <div class="row">
                <div class="col-xs-12 col-sm-4">
                  <div class="description-block border-right">
                    <h4 class="text-blue">{{(cliente_selected.valor_operacion|| 0)| currency}}</h4>
                    <span>VALOR OPERACIÓN</span>
                  </div>
                </div>
                <div class="col-xs-12 col-sm-4">
                  <div class="description-block border-right">
                    <h4 class="text-green">{{(totalPagosRealizados(cliente_selected) || 0) | currency}}</h4>
                    <span>-PAGOS REALIZADOS</span>
                  </div>
                </div>
                <div class="col-xs-12 col-sm-4">
                  <div class="description-block">
                    <h4 class="text-red">{{(saldoPendiente(cliente_selected) || 0) | currency}}</h4>
                    <span>=SALDO PENDIENTE</span>
                  </div>
                </div>

              </div>



            </mat-tab>
          </mat-tab-group>

        </div>

        <div class="card-footer">
          <!-- <div class="row">
            <div class="col-sm-11 ml-sm-auto">
              <button type="submit" class="btn btn-primary">Guardar</button>

            </div>
          </div> -->
        </div>






      </div>


    </div>
  </div>

</div>