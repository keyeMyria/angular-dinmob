<div *ngIf="loading">
  <mat-spinner class="loading"></mat-spinner>
</div>


<mat-tab-group>

  <!-- Lote -->
  <mat-tab label="Lote">

    <div class="container pt-3">
      <div class="form-group row">
        <label for="obra" class="col-form-label col-sm-3">Obra</label>
        <div class="col-sm-9">
          <input type="text" class="form-control" name="obra" [(ngModel)]="lote.lote.obra">
        </div>
      </div>
      <div class="form-group row">
        <label for="manzana" class="col-form-label col-sm-3">Manzana</label>
        <div class="col-sm-9">
          <input type="text" class="form-control" [(ngModel)]="lote.lote.manzana" name="manzana">
        </div>
      </div>
      <div class="form-group row">
        <label for="id_lote" class="col-form-label col-sm-3">Lote</label>
        <div class="col-sm-9">
          <input type="text" class="form-control" [(ngModel)]="lote.lote.id_lote" name="id_lote">
        </div>
      </div>
      <div class="form-group row">
        <label for="id_estado_venta" class="col-form-label col-sm-3">Estado Venta</label>
        <div class="col-sm-9">
          <select class="form-control" [(ngModel)]="lote.lote.id_estado_venta" name="id_estado_venta">
            <option value="">Seleccionar...</option>
            <option [value]="estado.id_estado_lote" *ngFor="let estado of estados">{{estado.descripcion}}</option>
          </select>
        </div>
      </div>
      <div class="form-group row">
        <label class="col-form-label col-sm-3" for="fecha_cambio_estado">Fecha Estado</label>
        <div class="col-sm-9">
          <div class="input-group">
            <input class="form-control" placeholder="yyyy-mm-dd" type="text" name="fecha_cambio_estado" id="fecha_cambio_estado" [(ngModel)]="lote.lote.fecha_cambio_estado"
              [matDatepicker]="dpFechaEstado" (ngModelChange)="onFechaChange()">
            <span class="input-group-btn">
              <button class="btn btn-secondary" type="button" (click)="dpFechaEstado.open()">
                <i class="fa fa-calendar"></i>
              </button>
            </span>
          </div>
          <mat-datepicker touchUi="true" #dpFechaEstado></mat-datepicker>
        </div>
      </div>
      <div class="form-group row">
        <label for="valor_base" class="col-form-label col-sm-3">Precio de Lista</label>
        <div class="col-sm-9">
          <input type="text" class="form-control" [(ngModel)]="lote.lote.valor_base" name="valor_base">
        </div>
      </div>
      <div class="form-group row">
        <label for="valor_ampliacion" class="col-form-label col-sm-3">Valor Ampliación</label>
        <div class="col-sm-9">
          <input type="text" class="form-control" [(ngModel)]="lote.lote.valor_ampliacion" name="valor_ampliacion">
        </div>
      </div>
    </div>

    <div class="form-group">
      <div class="col-sm-9">
        <button type="submit" class="btn btn-primary">Guardar Cambios</button>
      </div>
    </div>

  </mat-tab>


  <!-- Cliente -->
  <mat-tab label="Clientes">

    <div class="container pt-3">

      <div class="table-responsive">
        <table class="table table-striped table-align-middle">
          <thead>
            <tr>
              <th></th>
              <th>Nombre</th>
              <th>Activo</th>
              <th>Fecha Activación</th>
              <th>Fecha Cancelación</th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let cliente of lote.clientes">
              <td>
                <mat-checkbox (change)="seleccionarCliente($event,cliente)"></mat-checkbox>
              </td>
              <td>{{cliente.nombre}}</td>
              <td>{{cliente.activo|numberToYesNo:'AC'}}</td>
              <td>{{cliente.fecha_activo| date:'mediumDate':'':'es'}}</td>
              <td>{{cliente.fecha_cancelacion| date:'mediumDate':'':'es'}}</td>
              <td>
                <button mat-button class="no-min" (click)="gotoCliente(cliente)">
                  <i class="fa fa-pencil"></i>
                </button>
              </td>
            </tr>

          </tbody>

        </table>
      </div>

      <div class="table-responsive">
        <table class="table table-striped">
          <thead>
            <tr>
              <th>Programación</th>
              <th>Pago</th>
              <th>Monto</th>
              <th>Tipo</th>
              <th>Forma</th>
              <th>Nota</th>
              <th>Validado</th>
              <th>Comprobante</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let pago of cliente_selected.pagos">
              <td>{{pago.fecha_programada| date:'mediumDate':'':'es'}}</td>
              <td>{{pago.fecha_pago| date:'mediumDate':'':'es'}}</td>
              <td>{{pago.monto|currency}}</td>
              <td>{{pago.tipo_pago}}</td>
              <td>{{pago.forma_pago}}</td>
              <td>{{pago.nota}}</td>
              <td>
                <span class="badge" [ngClass]="pago.validado=='1'?'badge-success':'badge-secondary'">
                  {{pago.validado|numberToYesNo:'VAL'}}
                </span>
              </td>
              <td>
                <a class="btn btn-outline-secondary btn-sm" [href]="'/controlapi/public/comprobantes/'+pago.file_ficha_deposito">
                  <i class="fa fa-money"></i>
                </a>
                <!--                 <button mat-button class="no-min">
                  <i class="fa fa-money"></i>
                </button> -->
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="row">
        <div class="col-xs-12 col-sm-4">
          <div class="description-block border-right">
            <h4 class="text-primary">{{(cliente_selected.valor_operacion|| 0)| currency}}</h4>
            <span>VALOR OPERACIÓN</span>
          </div>
        </div>
        <div class="col-xs-12 col-sm-4">
          <div class="description-block border-right">
            <h4 class="text-success">{{(totalPagosRealizados(cliente_selected) || 0) | currency}}</h4>
            <span>-PAGOS REALIZADOS</span>
          </div>
        </div>
        <div class="col-xs-12 col-sm-4">
          <div class="description-block">
            <h4 class="text-danger">{{(saldoPendiente(cliente_selected) || 0) | currency}}</h4>
            <span>=SALDO PENDIENTE</span>
          </div>
        </div>

      </div>

    </div>


  </mat-tab>

</mat-tab-group>