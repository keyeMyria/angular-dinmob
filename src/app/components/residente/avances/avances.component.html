<button mat-fab style="position:fixed; top:100px; right:20px; z-index:100" (click)="drawer.opened= !drawer.opened">
    <mat-icon aria-label="toggle side drawer">home</mat-icon>
</button>

<mat-drawer-container class="drawer-container">
    <mat-drawer #drawer [mode]="mobileQuery.matches ? 'over':'side'" [opened]="!mobileQuery.matches" style="width:250px">
        <mat-card>
            <div class="mb-2">
                <select class="form-control" [(ngModel)]="obra_selected" (change)="cargarObra(obra_selected)">
                    <option value="">Seleccionar...</option>
                    <option [value]="obra.id_obra" *ngFor="let obra of obras">{{obra.nombre}}</option>
                </select>
            </div>
            <!--    <div class="d-flex">
                <span><i class="fa fa-share"></i></span>
                <span>{{obra?.obra?.nombre || ""}}</span>
                <div class="spacer"></div>
                <span class="badge badge-pill badge-warning align-self-center mr-2">{{obra?.manzanas?.length || "0"}}</span>
            </div> -->
        </mat-card>
        <div class="mb-3">
            <mat-accordion>
                <mat-expansion-panel *ngFor="let manzana of obra?.manzanas" [hideToggle]="false">
                    <mat-expansion-panel-header>
                        <span>{{manzana.nombre}}</span>
                        <div class="spacer"></div>
                        <span class="badge badge-pill badge-primary align-self-center mr-2">{{manzana.lotes?.length || "0"}}</span>

                    </mat-expansion-panel-header>

                    <ul class="list-group">
                        <!--  <li class="list-group-item">({{lote.prototipos?.length || "0"}}) {{lote.nombre}}</li> -->
                        <button type="button" class="list-group-item list-group-item-action" *ngFor="let lote of manzana.lotes" (click)="getAvancesLote(lote)">({{lote.prototipos?.length || "0"}}) {{lote.nombre}}</button>
                    </ul>

                </mat-expansion-panel>
            </mat-accordion>
        </div>
    </mat-drawer>

    <mat-drawer-content>
        <!-- 100vh = alto del dispositivo -56 de la toolbar cuando está en modo mobile -3rem= mb-5 -->
        <div class="container mb-5" style=" min-height: calc(100vh - 56px - 3rem);">


            <div class="row">

                <!--              <div class="col-4">
                    <mat-card>
                        <div class="mb-2">
                            <select class="form-control" [(ngModel)]="obra_selected">                                
                                <option value="">Seleccionar...</option>
                                <option [value]="obra.id_obra" *ngFor="let obra of obras">{{obra.nombre}}</option>
                            </select>
                        </div>
                        <div class="d-flex">                           
                            <span>{{obra?.obra?.nombre || ""}}</span>
                            <div class="spacer"></div>
                            <span class="badge badge-pill badge-warning align-self-center mr-2">{{obra?.manzanas?.length || "0"}}</span>
                        </div>
                    </mat-card>

                    <mat-accordion>
                        <mat-expansion-panel *ngFor="let manzana of obra?.manzanas" [hideToggle]="false">
                            <mat-expansion-panel-header>
                                <span>{{manzana.nombre}}</span>
                                <div class="spacer"></div>
                                <span class="badge badge-pill badge-primary align-self-center mr-2">{{manzana.lotes?.length || "0"}}</span>

                            </mat-expansion-panel-header>
                            <ul class="list-group" *ngFor="let lote of manzana.lotes">
                                <li class="list-group-item">({{lote.prototipos?.length || "0"}}) {{lote.nombre}}</li>
                            </ul>
                        </mat-expansion-panel>
                    </mat-accordion>

                </div> -->

                <div class="col">
                    <nav class="navbar navbar-expand-lg navbar-light bg-light ">
                        <div class="collapse navbar-collapse" id="navbarSupportedContent">
                            <ul class="navbar-nav mr-auto">
                                <li class="nav-item active">
                                    <button class="btn btn-light" type="submit">Terminar</button>
                                </li>
                                <li class="nav-item">
                                    <button class="btn btn-light" type="submit">Liberar</button>
                                </li>
                                <li class="nav-item">
                                    <button mat-button [matMenuTriggerFor]="menu">
                                        <mat-icon>delete</mat-icon>
                                    </button>
                                    <mat-menu #menu="matMenu" xPosition="before" [overlapTrigger]="false">
                                        <button mat-menu-item>Avance</button>
                                        <button mat-menu-item>Liberación</button>
                                    </mat-menu>
                                </li>
                                <li class="nav-item">
                                    <button mat-icon-button (click)="comentarioAvances()">
                                        <mat-icon>chat_bubble</mat-icon>
                                    </button>
                                </li>
                            </ul>
                        </div>
                    </nav>

                    <ol class="breadcrumb colorBread">
                        <li class="breadcrumb-item">
                            <a href="#">{{lote?.lote.obra}}</a>
                        </li>
                        <li class="breadcrumb-item">
                            <a href="#">{{lote?.lote.manzana}}</a>
                        </li>
                        <li class="breadcrumb-item active">{{lote?.lote.nombre}}</li>
                    </ol>
                    <div class="avances">
                        <mat-accordion>

                            <mat-expansion-panel *ngFor="let partida of lote?.acordeon" [hideToggle]="true">
                                <mat-expansion-panel-header [ngClass]="{'bg-info text-white': partidaFinalizada(partida)}">
                                    <span>{{partida.nombre}}</span>
                                    <div class="spacer"></div>
                                    <div class="collapse-header-btns">
                                        <small class="pull-right">{{numSubpartidasFinalizadas(partida)}}
                                            <span class="hidden-xs">de {{partida.subpartidas.length || "1"}}</span>
                                        </small>
                                    </div>
                                </mat-expansion-panel-header>
                                <div *ngIf="partida.subpartidas.length>0">
                                    <ul class="list-group">
                                        <li class="list-group-item" *ngFor="let subpartida of partida?.subpartidas">
                                            <div class="d-flex">
                                                <mat-checkbox>{{subpartida.nombre}}
                                                    <div style="font-size: 15px;">
                                                        <span class="badge" [ngClass]="{'badge-secondary':!subpartida.fecha_fin, 'badge-primary':subpartida.fecha_fin}">
                                                            <i class="fa fa-legal"></i>{{subpartida.fecha_fin|| "No terminada"}}</span>
                                                        <span class="badge" [ngClass]="{'badge-secondary':!subpartida.fecha_liberacion, 'badge-success':subpartida.fecha_liberacion}">
                                                            <i class="fa fa-usd"></i>{{subpartida.fecha_liberacion|| "No liberada"}}</span>
                                                    </div>
                                                </mat-checkbox>
                                                <div class="spacer"></div>
                                                <div>
                                                    <button mat-icon-button>
                                                        <mat-icon>camera_alt</mat-icon>
                                                    </button>
                                                </div>
                                            </div>
                                        </li>
                                    </ul>
                                </div>
                                <div *ngIf="partida.subpartidas.length===0">
                                    <ul class="list-group">
                                        <li class="list-group-item">
                                            <div class="d-flex">
                                                <mat-checkbox>
                                                    <div style="font-size: 15px;">
                                                        <span class="badge badge-secondary" [ngClass]="{'badge-secondary':!partida.fecha_fin, 'badge-primary':partida.fecha_fin}">
                                                            <i class="fa fa-legal"></i>{{partida.fecha_fin || "No terminada"}}</span>
                                                        <span class="badge badge-secondary" [ngClass]="{'badge-secundary':!partida.fecha_liberacion, 'badge-success':partida.fecha_liberacion}">
                                                            <i class="fa fa-usd"></i>{{partida.fecha_liberacion || "No liberada"}}</span>
                                                    </div>
                                                </mat-checkbox>
                                                <div class="spacer"></div>
                                                <div>
                                                    <button mat-icon-button>
                                                        <mat-icon>camera_alt</mat-icon>
                                                    </button>
                                                </div>
                                            </div>
                                        </li>
                                    </ul>
                                </div>
                            </mat-expansion-panel>



                        </mat-accordion>
                    </div>
                </div>
            </div>
        </div>
    </mat-drawer-content>
</mat-drawer-container>